<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ndn-lite: Design Drafts of the NDN-Lite Forwarder</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.jpeg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ndn-lite
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Design Drafts of the NDN-Lite Forwarder </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Occasional Dead Nonce List </h2>
<p>Nonce is used to eliminate Interest loop when the looping time is longer than its lifetime and no corresponding Data. However this is a very rare case, since the default lifetime is 4s, and the access time from LA to Shanghai is about 200ms (non official data by S.K.S). Especially, our work is used for local network of constrained devices. It's reasonable to ignore nonces.</p>
<p>But there's another solution, to exploit the garbage collecting of Name Tree, which is an occasional event. When a PIT entry is freed, put the nonce into the Name Tree entry, which is freed but not collected. Then if an Interest carrying the same name comes, new PIT entry will be created at the same place. We can get the nonce back and tell if it's a looped Interest.</p>
<p>Currently I gave a more simplified implementation&mdash;randomly pick a PIT and check the nonce. (Randomised Nonce List) I don't think it works but no harm.</p>
<h2>Software-Defined Strategy </h2>
<p>One of the biggest difference between NDN-Lite and NFD is the position of applications. In NDN-Lite, applications connect to the forwarder directly without a face, and the OnInterest callback is executed before forwarding the Interest. So the application who registered the prefix can control the forwarding of Interests under it. Regardless of the security, a software- defined forwarding strategy can be implemented.</p>
<p>Currently the OnInterest can only control whether to suppress or multicast it.</p>
<h2>Differential Name Tree </h2>
<p>Current name tree is not scalable due to the limitation on the length of name components. This can be overcome by adding an <code>overlap</code> field into the entry. The <code>overlap</code> means the length of the common prefix shared with its left brother. The use <code>overlap</code> enables a differential coding. </p><div class="fragment"><div class="line"> {C++}</div><div class="line">struct entry{</div><div class="line">  uint8_t val[COMPONENT_LEN];</div><div class="line">  uint8_t overlap;</div><div class="line">  entry* left_child;</div><div class="line">  entry* right_bro;</div><div class="line">};</div><div class="line">string entry::real_name(){</div><div class="line">  return left_bro()-&gt;real_name()[0:overlap] + string(val);</div><div class="line">}</div></div><!-- fragment --><p> For example, we have two names <code>/ndn/3C15C2B80252</code> and <code>/ndn/3C15C2B80264</code>, and let <code>COMPONENT_LEN=5</code>. The tree will be: </p><div class="fragment"><div class="line">(&quot;\x08\x03ndn&quot;, 0)</div><div class="line">    |</div><div class="line">    |</div><div class="line">(&quot;\x08\x0b3C1&quot;, 0) -&gt; (&quot;5C2B8&quot;, 5) -&gt; (&quot;0252&quot;, 10) -&gt; (&quot;64&quot;, 12)</div></div><!-- fragment --><p> The last two nodes in the graph are what we want.\ This also accelerate string comparing.</p>
<h2>Content Store Draft </h2>
<p>Though the entries in current NameTree is hard-coded, we can make it flexable: </p><div class="fragment"><div class="line"> {C++}</div><div class="line">struct nametree_entry{</div><div class="line">  // NDN_NAMETREE_ENTRY_TYPE_CNT is the last entry in NDN_NAMETREE_ENTRY_TYPE.</div><div class="line">  ndn_table_id_t entries[NDN_NAMETREE_ENTRY_TYPE_CNT];</div><div class="line">};</div></div><!-- fragment --><p> We can use compiler flags to control <code>NDN_NAMETREE_ENTRY_TYPE</code>. I don't have a very clear idea on how to implement the content store. Maybe we can only implement it on platforms that support malloc(). Or do it only in FIFO, since a queue can support variable emelent sizes. CS is important when we want to extend NDN-Lite to mobile scenarios, though currently we only focus on Home IoT.</p>
<h2>Thread Safety of MsgQueue </h2>
<p>Current MsgQueue is not thread-safe. A mutex can give the thread safety but still not reentrancy, which may be more important. The only solution for reentrancy is to only allow one task writing and the other reading. So we need a different queue for faces. It seems that no atomic operation is needed. </p><div class="fragment"><div class="line"> {C++}</div><div class="line">struct OneWayQueue{</div><div class="line">  uint8_t buf[BUF_SIZE];</div><div class="line">  int32_t roar;</div><div class="line">  int32_t head;</div><div class="line">}</div><div class="line"></div><div class="line">void PutDataToNormalSide(uint8_t* data, uint32_t len){</div><div class="line">  // Only called from ISR side, won&#39;t be interrupted.</div><div class="line">  // Codes dealing with rewind are omitted</div><div class="line">  memcpy(buf + roar, data, len);</div><div class="line">  roar += len;</div><div class="line">}</div><div class="line"></div><div class="line">uint32_t ReadDataFromISRSide(uint8_t* data, uint32_t len){</div><div class="line">  int32_t datasize = int32_t(roar) - int32_t(head); // Safe, read only</div><div class="line">  if(datasize == 0) return 0;</div><div class="line">  if(datasize &lt; 0) datasize += BUF_SIZE;</div><div class="line">  memcpy(data, buf + head, datasize); // Safe, data won&#39;t be changed</div><div class="line">  return datasize;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
